<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>نظام الاختبارات الإلكتروني</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-color: #2A5C82;
            --secondary-color: #38A3A5;
            --success-color: #57CC99;
            --danger-color: #FF6B6B;
            --light-color: #F8F9FA;
            --dark-color: #343A40;
        }

        * {
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
            min-height: 100vh;
            padding: 20px;
			text-align: left;
            font-family: 'Arial', sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .login-form, .quiz-container, .result {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .hidden {
            display: none;
        }

        input {
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: var(--primary-color);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }

        .question {
            margin: 20px 0;
            padding: 15px;
            border-left: none;
            background: var(--light-color);
			border-right: 4px solid #2A5C82;

        }

        .option {
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        
        .option:hover {
            transform: translateX(-10px);
        }
		
        .selected {
            background: var(--success-color) !important;
            color: white;
        }

        .timer {
            position: fixed;
            top: 20px;
            left: auto;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
			right: 20px;
        }

        .answer-report {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .correct-answer {
            color: #57CC99;
            font-weight: bold;
        }

        .user-answer {
            color: #2A5C82;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-form" id="loginForm">
            <h2>تسجيل الدخول</h2>
            <input type="text" id="username" placeholder="اسم المستخدم">
            <input type="password" id="password" placeholder="كلمة المرور">
            <button type="button" onclick="startQuiz()">بدء الاختبار</button>
        </div>

        <div class="quiz-container hidden" id="quizContainer">
            <div id="questions"></div>
            <button onclick="submitQuiz()">إنهاء الاختبار</button>
        </div>

        <div class="result hidden" id="resultSection"></div>
        <div class="timer hidden" id="timer">10:00</div>
    </div>

    <script>
        // الثوابت والإعدادات
        const CORRECT_PASSWORD = "2485";
        const firebaseConfig = {
            apiKey: "AIzaSyBNBPYkYxOOf_p4IdV2GFtT6ovrsGWgsrY", // استبدل بقيمك
            authDomain: "student-results-app-1be4e.firebaseapp.com",
            databaseURL: "https://student-results-app-1be4e-default-rtdb.firebaseio.com",
            projectId: "student-results-app-1be4e",
            storageBucket: "student-results-app-1be4e.firebasestorage.app",
            messagingSenderId: "999964098772",
            appId: "1:999964098772:web:8e34ed3c211bffe33f7b41"
        };

        // تهيئة Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // المتغيرات العامة
        //let questions = [];
        let userAnswers = [];
        let timeLeft = 600;
        let timer;

        // إنشاء الأسئلة
		let questions = [
    {
        question: "1. Is a CT system equipped with multiple rows of CT detectors to create images of multiple sections?",
        options: ["A. first generation", "B. sixth Generation", "C. Fourth Generation", "D. Fifth Generation", "E. seventh Generation"],
        correct: 4 // E
    },
    {
        question: "2. Regarding CT scan generations, which statement is correct?",
        options: ["A. fifth generation uses helical scanning", "B. third generation uses translate rotate motion", "C. sixth generation uses electron beam x ray source", "D. seventh generation uses multiple rows of detectors", "E. fourth generation uses dual source energy"],
        correct: 3 // D
    },
    {
        question: "3. Differentiating between the calcifications and contrast material (iodine)?",
        options: ["A. first generation", "B. second generation", "C. fourth generation", "D. seventh generation", "E. eighth generation"],
        correct: 4 // E
    },
    {
        question: "4. What is the working life of x ray tubes in helical CT scanners?",
        options: ["A. About 10,000 to 40,000 hours", "B. About 1000 hours", "C. About 5,000 hours", "D. About 2,000 hours", "E. About 200 hours"],
        correct: 0 // A
    },
    {
        question: "5. Increasing the number of detector rows results in ……?",
        options: ["A. increasing the z axis coverage slab thickness", "B. increasing the number of gantry rotations necessary to image the selected field", "C. increasing the strain on the x ray tube", "D. increasing scan length", "E. none of the above"],
        correct: 0 // A
    },
    {
        question: "6. Cone beam configuration is used in which generation?",
        options: ["A. seventh generation", "B. fourth generation", "C. third generation", "D. second generation", "E. first generation"],
        correct: 0 // A
    },
    {
        question: "7. What is the primary difference between MSCT and SSCT?",
        options: ["A. The gantry rotations", "B. The x ray tube", "C. The scan length", "D. The detector arrangement", "E. all of the above"],
        correct: 3 // D
    },
    {
        question: "8. Which type of detector arrays consist of parallel rows of equal thickness?",
        options: ["A. Matrix detectors", "B. Selective detectors", "C. Hybrid detectors", "D. Linked detectors", "E. Adaptive array detectors"],
        correct: 0 // A
    },
    {
        question: "9. What is a disadvantage of cone-beam artifacts in MSCT?",
        options: ["A. Cone beam artifact severity is directly proportional to the number of detector rows", "B. Cone beam artifacts result in consistent and identical images", "C. Cone beam artifacts are more pronounced in SSCT than in MSCT", "D. Cone beam artifacts can be reduced with wider x-ray beam widths", "E. Cone-shaped x ray beam sampling is the same at 0 and at 180 degrees"],
        correct: 0 // A
    },
    {
        question: "10. With the introduction of multiple detector arrays, what determines the slice thickness in CT scanners?",
        options: ["A. The detector size", "B. The collimator", "C. The spatial resolution", "D. The x-ray tube", "E. The contrast resolution"],
        correct: 0 // A
    },
    {
        question: "11. In Dual Source CT, how many X-ray tubes and detector arrays are present?",
        options: ["A. three", "B. two", "C. one", "D. four", "E. five"],
        correct: 1 // B
    },
    {
        question: "12. What is the key to high sensitivity and specificity in imaging with dual energy acquisition?",
        options: ["A. Utilizing two detectors", "B. Rapid alternation between high and low kilovoltage settings", "C. X-ray tubes set at different energies", "D. Single source dual energy", "E. Using high energy electron beam"],
        correct: 2 // C
    },
    {
        question: "13. In DECT, how many images are acquired per location?",
        options: ["A. three", "B. four", "C. one", "D. five", "E. two"],
        correct: 4 // E
    },
    {
        question: "14. What factors determine the degree of X-ray beam attenuation in a material?",
        options: ["A. tissue composition and photon energy level", "B. exercise and diet", "C. body temperature and heart rate", "D. blood type and blood pressure", "E. water intake"],
        correct: 0 // A
    },
    {
        question: "15. What is the function of the collimators in CT scan?",
        options: ["A. Rotate mounted scan frame that surrounds the patient", "B. Approach the patient from both the front and back", "C. Capture x-ray photons and convert them into electrical signals", "D. Convert the analog information into digital data", "E. Define slice thickness and restrict x-ray beam to the cross section of interest"],
        correct: 4 // E
    },
    {
        question: "16. In MSCT scanners, one disadvantage that summarized by one of the following:",
        options: ["A. Less contrast resolution", "B. Partial volume streaking", "C. Less scan time for tissue imaging", "D. More radiation dose received by the patient", "E. more detector array consuming"],
        correct: 3 // D
    },
    {
        question: "17. In MS/MD CT, if each detector was 1.25 mm long and the scanner had 16 rows of detectors, the z axis coverage (slab thickness) per gantry rotation would total……mm?",
        options: ["A. 10mm", "B. 30mm", "C. 20mm", "D. 50mm", "E. E-22m"],
        correct: 2 // C
    },
    {
        question: "18. The degree that a material will attenuate the X-ray beam is dependent on:",
        options: ["A. density of the absorber", "B. radiation beam energy", "C. atomic number of the absorber", "D. A and B", "E. all of the above"],
        correct: 4 // E
    },
    {
        question: "19. Utilizes two X-ray tubes and two detectors to obtain simultaneous dual energy acquisition and data processing?",
        options: ["A. Dual Source Dual Energy (DSDE)", "B. Dual Source Single Energy (DSSE)", "C. Single Source Dual Energy (SSDE)", "D. all of the above", "E. none of the above"],
        correct: 0 // A
    },
    {
        question: "20. In this mode, both X-ray tubes work at the same kVp setting?",
        options: ["A. Dual Source Dual Energy (DSDE)", "B. Dual Source Single Energy (DSSE)", "C. Single Source Dual Energy (SSDE)", "D. all of the above", "E. none of the above"],
        correct: 1 // B
    },
    {
        question: "21. The…..equipped with two data measurement systems, that it is possible to double the resolution?",
        options: ["A. SSCT", "B. MSCT", "C. EBSCT", "D. DSCT", "E. not all of the above"],
        correct: 3 // D
    },
    {
        question: "22. In….the slice thickness is determined by detector configuration and not x ray beam collimation?",
        options: ["A. SSCT", "B. MSCT", "C. EBSCT", "D. Helical CT", "E. not all of the above"],
        correct: 1 // B
    },
    {
        question: "23. In (…..) X ray beam collimation was designed such that the z axis width of the x ray beam at the isocenter (center of rotation) was the desired slice thickness?",
        options: ["A. SSCT", "B. MSCT", "C. EBSCT", "D. Helical CT", "E. not all of the above"],
        correct: 1 // B
    },
    {
        question: "24. Regarding types of detector arrays:",
        options: ["A. Matrix detectors, which consist of parallel rows of equal thickness", "B. Hybrid detectors with smaller detector rows in the center", "C. Adaptive array detectors that consist of detector rows with varying thickness", "D. C and B", "E. all of the above"],
        correct: 4 // E
    },
    {
        question: "25. In MSCT, if the detector width is 5mm, beam width 20mm and the table moves 10mm during one tube rotation, what is the pitch?",
        options: ["A. 2", "B. 1.5", "C. 2.5", "D. 1", "E. 0.5"],
        correct: 4 // E
    }
	];

        // التحقق من الإكمال السابق
        if (localStorage.getItem('quizCompleted')) {
            document.getElementById('loginForm').innerHTML = `
                <h2 style="color:${getComputedStyle(document.documentElement).getPropertyValue('--danger-color')}">
                    لقد أكملت الاختبار مسبقًا
                </h2>
                <p>لا يمكن إعادة المحاولة</p>
            `;
        }

        function startQuiz() {
            const password = document.getElementById('password').value;
            if (password !== CORRECT_PASSWORD) {
                alert('كلمة المرور غير صحيحة!');
                return;
            }

            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            document.getElementById('timer').classList.remove('hidden');
            
            userAnswers = new Array(questions.length).fill(-1);
            
            let html = '';
            questions.forEach((q, index) => {
                html += `
                    <div class="question">
                        <h4>${q.question}</h4>
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="selectAnswer(${index}, ${i})">${opt}</div>
                        `).join('')}
                    </div>
                `;
            });
            document.getElementById('questions').innerHTML = html;

            timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) submitQuiz();
            }, 1000);
        }

function selectAnswer(qIndex, aIndex) {
    const options = document.querySelectorAll(`.question:nth-child(${qIndex + 1}) .option`);
    options.forEach(opt => opt.classList.remove('selected'));
    options[aIndex].classList.add('selected');
    userAnswers[qIndex] = aIndex;
}

        async function submitQuiz() {
            clearInterval(timer);
            localStorage.setItem('quizCompleted', 'true');

            const score = userAnswers.reduce((acc, answer, index) => 
                answer === questions[index].correct ? acc + 1 : acc, 0);
            
            const totalScore = ((score / questions.length) * 25).toFixed(1);
            const username = document.getElementById('username').value;

            // حفظ النتائج في Firebase
            try {
                await database.ref('results').push({
                    username: username,
                    score: totalScore,
                    answers: userAnswers,
                    timestamp: new Date().toISOString()
                });
                console.log('تم الحفظ بنجاح');
            } catch (error) {
                console.error('حدث خطأ في الحفظ:', error);
            }

            // عرض النتيجة
            let answersReport = '';
            questions.forEach((q, index) => {
                const userAnswer = userAnswers[index] !== -1 ? 
                    q.options[userAnswers[index]] : 'لم يتم الإجابة';
                const correctAnswer = q.options[q.correct];
                
                answersReport += `
                    <div class="answer-report">
                        <h4>${q.question}</h4>
                        <p class="user-answer">إجابتك: ${userAnswer}</p>
                        <p class="correct-answer">الإجابة الصحيحة: ${correctAnswer}</p>
                    </div>
                `;
            });

            const resultHTML = `
                <h2>النتيجة النهائية</h2>
                <p>الاسم: ${username}</p>
                <p>الدرجة: ${totalScore}/25</p>
                ${totalScore >= 20 ? 
                    '<p style="color:green">أنت وحش! جائزتك 1000 دينار</p>' : 
                    totalScore >= 12.5 ? 
                    '<p style="color:blue">مبروك! نجحت في الاختبار</p>' : 
                    '<p style="color:red">اقرأ وين يالكسلان</p>'}
                <hr>
                <h3>تفاصيل الإجابات:</h3>
                ${answersReport}
                <button onclick="captureResult()">حفظ النتيجة</button>
            `;

            document.getElementById('resultSection').innerHTML = resultHTML;
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultSection').classList.remove('hidden');
        }

        function captureResult() {
            html2canvas(document.getElementById('resultSection')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'نتيجة-الاختبار.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
